## Gradle

* 빌드 툴의 진화
  * 메이크 : 빌드 개념을 확립(스크립트 기반)
  * 앤트 : 범용성을 높임(크로스 플랫폼 대응, XML기반)
  * 메이븐 : 빌드 스크립트의 작성 효율 높임(XML기반)
  * 그레이들 : 유연성을 높임(스크립트 기반)



* 그레이들은 그루비 기반 기술



* Build.gradle

  * apply plugin : 'java'

    * 자바 프로젝트 규칙과 자바 프로젝트 빌드에 필요한 테스크가 추가됨.

  * Repositories {

    	mavenCentral()

    }

    * 의존관계를 해결하기 위한 저장소로 메이븐 중앙 저장소를 지정.
    * dependencies 블록에서 지정한 의존 라이브러리들을 메이븐 중앙 저장소에서 자동으로 내려받을 수 있음.

  * compile

    * 프로덕션 코드를 컴파일하고 실행할 때 필요

  * testCompile

    * 테스트 코드를 컴파일하고 실행할 때 필요



* 빌드 실행 결과물은 build 디렉터리 아래에 생서오딤.
  * build/classes
    * main디렉터리 아래에 프로덕션 코드의 클래스파일 생성
    * test 디렉터리에 테스트 코드의 클래스 파일이 생성
  * build/libs
    * 프로덕션 코드를 압축한 jar파일



* 그래이들 래퍼
  * 사용할 그레이들 버전을 고정할 수 있음.
  * 젠킨스같은 CI 툴 실행환경에 그레이들을 설치하지 않아도 됨.



* 자바 플러그인
  * 자바 빌드에 필요한 __태스크__, 설정을 단순화하는 규칙, 구현하기 위한 속성 및 __소스세트__가 패키지로 구성된 빌드 기능 컴포넌트
    * 소스세트 : 프로젝트에 목적이 다른 코드나 리소스 섞일때 사용 예) 프로덕션 코드, 테스트 코드, 단위테스트, 통합테스트 등, 자바 플러그인에는 기본적으로 main, test 두가지 소스 세트 정의됨.
    * 태스크
      * 자바를 빌드할때 필요한 작업이 태스크로 정의됨.
      * 코드 파일 컴파일, 테스트, Javadoc 생성, jar파일 압축 등



* Application 플러그인
  * 자바 어플리케이션을 실행하거나 배포하기 위한 플러그인, java 플러그인 확장
  * 주요 용도
    * 빌드 스크립트에 메인 클래스를 지정해서 그레이들 어플리케이션을 실행
    * 어플리케이션을 실행 환경에 배포하기 위한 압축파일 생성



* War 플러그인
  * 자바 웹 어플리케이션 빌드할 때 사용



* 그레이들 빌드

  * 그레이들 빌드 흐름

    ~~~
    1. 명령어 해석 : gradle명령어 및 실행 argument 읽음
    2. 스크립트 파일 초기화
    3. 프로젝트 설정
    4. 태스크 실행
    ~~~

  * 스크립트 파일 초기화

    * 스크립트 파일을 읽거나 그레이들의 실체 도메인 객체를 생성

  * 프로젝트 설정

    * 프로젝트가 참조하는 의존 라이브러리 해석이나 태스크 생성 같은 빌드 실행을 위한 준비 작업
    * 정의된 태스크를 조사해서 태스크가 ㄴ의존관계를 그래프로 만든 태스크 그래프 작성

  * 태스크 실행

    * 프로젝트 설정에서 만든 태스크 그래프에서 실행 대상 태스크를 추출하여 실행



* Intellij IDEA는 build.gradle을 프로젝트를 열 때는 포함된 디렉터리보다 빌드 스크립트(build.gradle)을 여는게 좋다. 디렉터리를 지정해서 열려면 제대로 열리지 않을 수도 있다.



* 그래이들 래퍼
  * 수동으로 그레이들을 내려받아서 설치 않고 그레이들을 실행할 수 있는 방법
  * 그레이들 래퍼의 실체는 빌드 스크립트와 함께 프로젝트에 포함된 래퍼 스크립트(gradlew.bat또는 gradelw)이다.
  * gradlew 명령으로 빌드를 실행하면 빌드 전에 그레이들 본체를 내려받아서 빌드 실행



* 메이븐에서 그레이들로

  * Maven 플러그인을 사용하는 프로젝트라면 상응하는 gradle 플러그인이 있는지 확인 먼저해야함.

  * pom.xml을 변환해서 build.gradle을 생성 (수작업으로 생성, 단, maven과 gradle 디렉토리 구조가 같다는 전제하에)

  * Pom.xml을 이용해서 그레이들 프로젝트 생성

    * 그레이들은 pom.xml 파일을 이용해서 메이븐의 POM을 읽고 이를 그레이들 프로젝트로 변환, 변환은 내장 태스크인 init 태스크 사용

    * 예

      ~~~~
      cd my-project
      gradle init --type pom
      ~~~~

    * build.gradle이 pom.xml 에 있는 디렉터리에 생성됨.

    * settings.gradle이나 그래이들 래퍼 같은 일반적인 그레이들 프로젝트 파일들도 함께 생성됨.

    * 일반적인 자바 프로젝트라면 생성된 그레이들 래퍼를 사용해서 바로 그레이들로 빌드할 수 있음(gradlew build)

    * (참고) project.build.sourceEncoing 요소는 변환 후 build.gradle에는 반영되지 않음. 자바 프로젝트에서 코드의 인코딩을 지정하려면 수동으로 설정 추가해야함.

    * (참고) 메이븐과 그레이들 의존관계 관리 방식 차이 : 메이븐은 해당 프로젝트에 가장 가까운 계층에 있는 의존관계 채택하지만, 그레이들은 Newest전략에 따라 최신 버전의 의존관계를 채택

# CAP

* 컴퓨터 과학 분야에서 분산 컴퓨터 시스템을 설명하는데 사용되는 이론
* 일관성(Consistency), 가용성(Availabilty),  분할 허용성(Partition Tolerlence)을 모두 동시에 지원하는 분산 컴퓨터 시스템은 없다라고 정의.



## 일관성

* 동시성, 동일성이라고도 하며, '다중 클라이언트에서 같은 시간에 조회하는 데이터는 항상 동일한 데이터임을 보증하는 것'
* RDB가 지원하는 가장 기본적인 기능
* NoSQL에서는 빠른 분산 처리를 위하여 일관성을 희생하기도 함 : 가용성과 분할 허용성을 지원하는 NoSQL은 일관성이 느슨하게 처리됨.
* 각 NoSQL은 분산 노드간에 데이터를 동기화를 위해 두가지 방법을 사용
  * 동기식 -> 데이터의 저장 결과를 클라이언트로 응답하기 전에 모든 노드에 데이터를 저장하는 동기식 방법 : 느린 응답시간, 강한 데이터의 정합성 보장
  * 비동기시 -> 메모리나 임시 파일에 기록하고 클라이언트에 먼저 응답한 다음, 특정 이벤트 또는 프로세스를 사용하여 노드로 데이터를 동기화 : 빠른 응답을 줄 수 있지만, 쓰기 노드에 장애가 발생하였을때 데이터 손실
  * 카산드라와 HBase에서는 데이터의 유실을 방지하기 위하여 메모리에 저장하기 전에 커밋로그 및 WAL(Write Ahead Log) 파일에 먼저 정보를 기록하여 데이터의 유실을 방지, Redis의 경우 AOP(Append Only File) 사용



## 가용성

* 모든 클라이언트의 읽기와 쓰기 요청에 대하여 항상 응답이 가능해야함을 보증하는 것.
* 내고장성을 가진 NoSQL은 클러스터 내에서 몇 개의 노드가 망가지더라도 정상적인 서비스가 가능.
* 몇몇 NoSQL은 가용성을 보장하기 위해 데이터 복제를 사용. 동일한 데이터를 다중 노드에 중복 저장하여 노드 장애시에도 데이터 유실되지 않도록 하는 방법
* 마스터-슬레이브 복제 방법과 피어 투 피어 복제 방법이 있음.
* (참고) 단일 고장점(SPOF : Single Point Of Failure) : 시스템 구성하는 개별 요소 중에서 하나의 요소가 망가졌을때 시스템 전체를 만드는 요소



## 네트워크 분할 허용성

* 분할된 네트워크 환경에서 동작하는 시스템에서 두 지역간의 네트워크가 단절되거나 네트워크 데이터의 유실이 일어나더라도 각 지역 내의 시스템은 정상적으로 동작 해야함

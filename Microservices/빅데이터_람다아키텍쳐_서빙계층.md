# 람다 아키텍쳐

## Problem

실시간에 임의의 데이터 집합에 대해 수행되는 임의의 함수를 계산하는 것은 문제가 있음

~~~
query = function data(all data)
~~~



## 1. 일괄처리 계층

- 마스터 데이터 집합을 저장
- 임의의 일괄처리 뷰를 계산해서 생성

## 2. 서빙계층

- 일괄처리 뷰에 무작위 접근
- 일괄처리 계층에 의해서 갱신됨

## 3. 속도계층

* 서빙 계층의 갱신이 오래 걸리는 것을 보완

* 고속 증분 알고리즘을 사용

* 결국은 일괄처리 계층이 속도 계층을 무효화하게 됨

* 뷰를 생성한다는 점에서는 유사

* 일괄처리 계층은 한번에 모든 데이터를 대상으로 하지만, 속도 계층은 최근 데이터만을 대상으로 함

  

# 서빙 계층

* 뷰를 색인(저장)하고 사전 계산된 데이터를 고속으로 질의하도록 인터페이스를 제공
* 일괄처리 계층에서 서빙 계층 뷰를 지속적으로 갱신하기 때문에 일괄처리 계층과 밀접하게 연관되어 있음
* 서빙 계층에 없는 데이터는 속도 계층에서 맡아서 처리하기 때문에 큰 문제는 없음.

## 서빙 계층에 대한 성능 측정 도구

1. **처리량(throughout)**
2. **지연시간(latency)**

-> 한번의 탐색과 스캔만 있으면 되도록 제한하는 것이 좋음



예) 시간별 조회수 구하기

-> 분할된 데이터를 한번에 모아서 처리하는 것은 지연시간이 있을 수 있음

![분할데이터](https://i.stack.imgur.com/7reue.png)



-> key, value 형태로 바로 접근할 수 있도록 하는 것이 좋음

| 시간   | 조회수  |
| ---- | ---- |
| 9시   | 12   |
| 10시  | 45   |
| 11시  | 67   |



# 요약

지연시간과 처리량을 최적하하기 위해 뷰를 조정하는 능력

무작위 쓰기를 제공하는 않는 것으로 생기는 간결함

일괄처리 계층에 있는 정규화 데이터와 서빙 계층에 있는 비정규화된 데이터를 저장할 수 있는 수용력

마스터 데이터 집합으로부터 재계산이 가능하기 때문에 원래부터 갖추어진 오류 내성과 수정 능력





## (참고) 서빙레이어 도구

* 서빙레이어의 대표적인 오픈 데이터베이스는 엘리펀트DB, HBase, 카산드라가 있음
* (참고) 엘리펀트 DB : https://github.com/nathanmarz/elephantDB
